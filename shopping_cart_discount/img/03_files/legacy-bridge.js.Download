(window.NArchWebpackJsonp=window.NArchWebpackJsonp||[]).push([[91,75,77,152,155,158,161,164],{"./packages/apps/bridge/src/bridge.ts":function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var n=s("./packages/libs/legacy-common/lib/index.js"),a=s("./packages/apps/legacy-dadata/src/index.ts"),i=s("./packages/libs/payments/lib/index.js"),r=s("./packages/libs/analytics/lib/index.js"),o=s("./packages/libs/core/lib/index.js"),c=s("./packages/libs/di/lib/index.js"),d=s("./packages/libs/feature-flags/lib/index.js"),l=s("./packages/libs/cookies/lib/index.js"),u=Object(c.g)(c.a),g=function(){function LegacyBridge(){}return LegacyBridge.getStoreConfig=function(e,t){return u.config.get(e,t)},LegacyBridge.emitEvent=function(e,t){o.p.dispatch(Object(o.Db)(e,t))},LegacyBridge.getStore=function(){return Object(o.nc)()},LegacyBridge.isFeatureEnabled=function(e){return Object(c.f)().get(d.b).isEnabled(e)},LegacyBridge.getCookieService=function(){return Object(c.f)().get(l.c)},LegacyBridge.getDispatcher=function(){return Object(o.nc)().dispatch},LegacyBridge.fetchCart=function(){return Object(o.nc)().dispatch(Object(o.Pb)())},LegacyBridge.fetchCartIfNeeded=function(e){return Object(o.nc)().dispatch(Object(o.Qb)(e))},LegacyBridge.cartProductAdd=function(e,t){return Object(o.nc)().dispatch(Object(o.wb)([{id:e,super_attr:t}]))},LegacyBridge.cartProductRemove=function(e){return Object(o.nc)().dispatch(Object(o.xb)(e))},LegacyBridge.cartProductUpdate=function(e){return Object(o.nc)().dispatch(Object(o.yb)(e))},LegacyBridge.cartCouponAdd=function(e){return Object(o.nc)().dispatch(Object(o.sb)(e))},LegacyBridge.cartCouponRemove=function(e){return Object(o.nc)().dispatch(Object(o.tb)(e))},LegacyBridge.getCart=function(e){return void 0===e&&(e=Object(o.nc)().getState()),Object(o.dc)(e)},LegacyBridge.getProduct=function(e){return Object(o.kc)(e)},LegacyBridge.getAddressSuggestionsService=function(){return Object(n.m)(a.a)},LegacyBridge.loadMinicart=function(){},LegacyBridge.registerComponent=function(e,t,s){Object(c.g)(o.h).register(e,t,s)},LegacyBridge.unregisterComponent=function(e){Object(c.g)(o.h).unregister(e)},LegacyBridge.findComponent=function(e){return Object(c.g)(o.h).find(e)},LegacyBridge.findComponentByName=function(e){return Object(c.g)(o.h).findByName(e)},LegacyBridge.domReady=n.j,LegacyBridge.DOMReady=n.b,LegacyBridge.fetchData=n.l,LegacyBridge.verifyPayment=i.b,LegacyBridge.initDadataFormService=a.c,LegacyBridge.verifyRussianPostalCode=a.d,LegacyBridge.getFormServiceFromDOMNode=a.b,LegacyBridge.addCustomEventToDataLayer=r.F,LegacyBridge.loginPageReferrer=n.n,LegacyBridge.eventEmitter=o.p,LegacyBridge}()},"./packages/apps/bridge/src/index.ts":function(e,t,s){"use strict";s.r(t);var n=s("./packages/apps/bridge/src/bridge.ts");window.LegacyBridge=n.a},"./packages/apps/legacy-dadata/src/api/index.ts":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s("./packages/libs/legacy-common/lib/index.js"),a=s("./packages/apps/legacy-dadata/src/suggestions/index.ts"),i=s("./packages/libs/di/lib/index.js"),r=(s("./packages/apps/legacy-dadata/src/api/responseCodes.ts"),function(e,t){return Object(i.g)(i.a).config.get("dadata/suggestions/enabled")?Object(n.m)(a.SuggestionsService).suggestAddress(e,null,20).then((function(e){if(!e.length)return{valid:!1};var s=e.filter((function(e){return e.data.postal_code===t})),n={valid:!!s.length};return s.length&&(n.address=s),n})):Promise.resolve({valid:!1})})},"./packages/apps/legacy-dadata/src/api/responseCodes.ts":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var n=new Map;n.set(400,"Invalid request:\n\n The invalid JSON.\n The required structure or data parameters are missing.\n The structure indicates an unsupported type.\n The number of fields in the records is more specified in the structure."),n.set(401,"The request does not have an API key or secret key"),n.set(402,"Insufficient funds to process the request, top up the balance"),n.set(403,"The request contains a non-existent key"),n.set(405,"The request was made with a method other than POST"),n.set(413,"The request contains more than 10 entries"),n.set(429,"Too many requests per second"),n.set(500,"An internal service error occurred during processing")},"./packages/apps/legacy-dadata/src/components/modal/addresses/index.tsx":function(e,t,s){"use strict";s.d(t,"a",(function(){return p}));var n=s("./common/temp/node_modules/.pnpm/tslib@2.3.1/node_modules/tslib/tslib.es6.js"),a=s("./packages/libs/legacy-common/lib/index.js"),i=s("./packages/libs/legacy-core/lib/index.js"),r=s("./common/temp/node_modules/.pnpm/classnames@2.3.1/node_modules/classnames/index.js"),o=s.n(r),c=s("react"),d=s.n(c),l=s("./common/temp/node_modules/.pnpm/react-custom-scrollbars@4.2.1_7a759d72fcbc11ce03c9de110c21df82/node_modules/react-custom-scrollbars/lib/index.js"),u=s.n(l),g=s("./packages/apps/legacy-dadata/src/components/modal/addresses/list.tsx"),trackVertical=function(e){return d.a.createElement("div",Object(n.a)({},e,{className:"track-vertical",style:{width:"2px",position:"absolute"}}))},thumbVertical=function(e){return d.a.createElement("div",Object(n.a)({},e,{className:"thumb-vertical"}))},p=function(e){function Addresses(t){var s=e.call(this,t)||this;return s.onConfirm=new i.a,s.onCancel=new i.a,s.onPickupAddress=new i.a,s.onAddressChange=function(e){var t=JSON.parse(e.currentTarget.dataset.fulladdress);s.setState({selectedAddress:t,isAcceptButtonDisabled:!1}),s.onPickupAddress.emit(t)},s.onClickCancelBtn=function(){s.setState({isVisible:!1}),s.onCancel.emit()},s.onClickCloseBtn=function(){s.setState({isVisible:!1}),s.onConfirm.emit(s.state.selectedAddress)},s.state={isAcceptButtonDisabled:t.addresses.length>1,isVisible:t.isVisible,selectedAddress:1===t.addresses.length?t.addresses[0]:null},s}return Object(n.g)(Addresses,e),Addresses.prototype.render=function(){var e=this.props,t=e.addresses,s=e.title,n=e.className,i=e.buttonLabelAccept,r=e.buttonLabelCancel,c=e.hint;return this.state.isVisible?d.a.createElement(a.e,{onClose:this.onClickCancelBtn,className:o()(n,"modal-dadata")},d.a.createElement(a.g,{title:s,dismiss:!0}),d.a.createElement(a.d,null,c&&d.a.createElement("div",{className:"hint"},d.a.createElement("p",{dangerouslySetInnerHTML:{__html:c}})),d.a.createElement(u.a,{style:{height:200,width:270},renderTrackVertical:trackVertical,renderThumbVertical:thumbVertical},d.a.createElement(g.a,{addresses:t,changeAddress:this.onAddressChange})),d.a.createElement("div",{className:"modal-buttons"},d.a.createElement(a.f,{className:"modal-cancel-button",label:r,onClick:this.onClickCancelBtn}),d.a.createElement(a.f,{disabled:this.state.isAcceptButtonDisabled,label:i,onClick:this.onClickCloseBtn})))):null},Addresses}(c.Component)},"./packages/apps/legacy-dadata/src/components/modal/addresses/list.tsx":function(e,t,s){"use strict";s.d(t,"a",(function(){return List}));var n=s("react"),List=function(e){return n.createElement("ul",null,e.addresses.map((function(t){var s,a=t.data,i=a.kladr_id,r=a.postal_code,o=t.unrestricted_value.split(", ").join(" "),c=1===e.addresses.length;return n.createElement("li",{className:"address-box",key:i},n.createElement("input",{type:"radio",className:"radio",name:"fullAddress[]","data-fulladdress":JSON.stringify(t),id:"kladr-id-"+i,checked:c,onChange:e.changeAddress}),n.createElement("label",{htmlFor:"kladr-id-"+i,className:"radio-label"},(s=[r,o],s.filter((function(e){return!!e}))).join(", ")))})))}},"./packages/apps/legacy-dadata/src/components/modal/index.ts":function(e,t,s){"use strict";s("./packages/apps/legacy-dadata/src/components/modal/addresses/index.tsx");var n=s("./packages/apps/legacy-dadata/src/components/modal/notice/index.tsx");s.d(t,"a",(function(){return n.a}))},"./packages/apps/legacy-dadata/src/components/modal/notice/index.tsx":function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s("./common/temp/node_modules/.pnpm/tslib@2.3.1/node_modules/tslib/tslib.es6.js"),a=s("./packages/libs/legacy-common/lib/index.js"),i=s("./common/temp/node_modules/.pnpm/classnames@2.3.1/node_modules/classnames/index.js"),r=s.n(i),o=s("react"),c=s.n(o),d=function(e){function Notice(t){var s=e.call(this,t)||this;return s.closeModal=function(){s.setState({isVisible:!1})},s.state={isVisible:t.isVisible},s}return Object(n.g)(Notice,e),Notice.prototype.render=function(){var e=this.props,t=e.title,s=e.message,n=e.buttonLabelAccept,i=e.className;return this.state.isVisible?c.a.createElement(a.e,{onClose:this.closeModal,className:r()("modal-dadata",i)},c.a.createElement(a.g,{title:t,dismiss:!0}),c.a.createElement(a.d,null,c.a.createElement("p",null,s),c.a.createElement(a.f,{label:n,onClick:this.closeModal}))):null},Notice}(o.Component)},"./packages/apps/legacy-dadata/src/index.ts":function(e,t,s){"use strict";s("./packages/apps/legacy-dadata/src/models/index.ts");var n=s("./packages/apps/legacy-dadata/src/api/index.ts");s.d(t,"d",(function(){return n.a}));var a=s("./packages/apps/legacy-dadata/src/suggestions/index.ts");s.d(t,"a",(function(){return a.SuggestionsService}));var i=s("./packages/apps/legacy-dadata/src/suggestions/form/service.ts");s.d(t,"b",(function(){return i.getFormServiceFromDOMNode})),s.d(t,"c",(function(){return i.initialize}));s("./packages/apps/legacy-dadata/src/components/modal/index.ts")},"./packages/apps/legacy-dadata/src/models/index.ts":function(e,t,s){},"./packages/apps/legacy-dadata/src/suggestions/form/service.ts":function(e,t,s){"use strict";s.r(t),s.d(t,"initialize",(function(){return initialize})),s.d(t,"getFormServiceFromDOMNode",(function(){return getFormServiceFromDOMNode}));var n,a=s("./common/temp/node_modules/.pnpm/tslib@2.3.1/node_modules/tslib/tslib.es6.js"),i=(s("./common/temp/node_modules/.pnpm/reflect-metadata@0.1.13/node_modules/reflect-metadata/Reflect.js"),s("./packages/libs/legacy-common/lib/index.js")),r=s("./packages/apps/legacy-dadata/src/components/modal/index.ts"),o=s("./packages/apps/legacy-dadata/src/components/modal/addresses/index.tsx"),c=s("react"),d=s("react-dom"),l=s("./common/temp/node_modules/.pnpm/rxjs@6.4.0/node_modules/rxjs/_esm5/operators/index.js"),u=s("./packages/apps/legacy-dadata/src/suggestions/index.ts"),g=s("./packages/libs/logger/lib/index.js"),p=s("./packages/libs/di/lib/index.js"),h=Symbol("lpp:form-service"),m=Object(p.g)(p.a);!function(e){e.apartment="apartment",e.city="city-settlement",e.street="street",e.house="house",e.zip="zip"}(n||(n={}));var f={city:"street",street:"house"},isVisible=function(e){var t=window.getComputedStyle(e),s="none"!==t.display&&"hidden"!==t.visibility;return s&&e.parentElement?isVisible(e.parentElement):s},compact=function(e){return e.filter((function(e){return!!e}))},v=!1,b=function(){function FormService(e,t,s){var a=this;this.inputObserver=s,this.onBlur=function(e){if(!v){v=!0;var t=a.DOMNodes,s=t.city,n=t.street,o=t.house,l=t.zip,u=a.getQuery();a.prevQuery!==u&&(s.value.length&&n.value.length&&o.value.length&&!l.value.length&&(a.invalidateAddress=!1,a.suggestionsService.suggestAddress(u).then((function(e){if(v=!1,e.length){if(1!==e.length||!e[0].data.postal_code||l.value===e[0].data.postal_code)return e.length>1?a.showPickupAddressForm(e):void 0;l.value=e[0].data.postal_code}else{var t=document.createElement("div");d.render(c.createElement(r.a,{buttonLabelAccept:Object(i.h)("dadata_btn_accept"),dismiss:!0,isVisible:!0,message:Object(i.h)("dadata_message_not_found"),title:Object(i.h)("dadata_title_not_found")}),t)}})).catch((function(e){v=!1,Object(g.b)(e)}))),s.value.length&&n.value.length&&o.value.length&&l.value.length&&(a.invalidateAddress=!1))}},this.onInput=function(e){switch(e.target.dataset.bounds){case n.apartment:a.invalidateAddress=!0;break;case n.zip:if(a.searchInProgress){a.searchInProgress=!1;break}a.invalidateAddress=!0}a.DOMNodes.street.disabled=!a.DOMNodes.city.value.length,a.DOMNodes.house.disabled=!a.DOMNodes.street.value.length,a.DOMNodes.zip.disabled=!a.DOMNodes.house.value.length,a.DOMNodes.apartment.disabled=!a.DOMNodes.house.value.length,a.DOMNodes.street.disabled&&(a.DOMNodes.street.value=a.DOMNodes.house.value=a.DOMNodes.zip.value=a.DOMNodes.apartment.value=""),a.DOMNodes.house.disabled&&(a.DOMNodes.house.value=a.DOMNodes.zip.value=a.DOMNodes.apartment.value=""),a.DOMNodes.zip.disabled&&(a.DOMNodes.apartment.value=""),a.userChanges=!0,a.externalChanges=!1,a.isValid()||a.setFullAddress(""),a.validatePlugin.resetForm(),a.validatePlugin.valid()},this.onInput2=function(e){a.onInput(e),a.userChanges=!1,a.externalChanges=!0,a.fetchFullAddressIfNeeded()},this.onSubmit=function(e){if("function"!=typeof a.submitHandler)throw new TypeError("Dadata/Suggestions/FormService.submitHandler is not a function");if(!a.validatePlugin||a.validatePlugin.valid()){if(a.isValid())return a.submitHandler(e);a.verifyPostalCode().then((function(){a.validatePlugin.valid()&&a.submitHandler(e)}))}},this.setNewAddress=function(e){var t=a.DOMNodes,s=t.city,n=t.street,i=t.house,r=t.zip,o=t.apartment;for(var c in s.value=a.getCity(e.data)||a.getSettlement(e.data),n.value=a.getStreet(e.data),i.value=a.getHouse(e.data),r.value=(e.data.postal_code||"").trim(),o.value=a.getFlat(e.data),a.DOMNodes)a.DOMNodes.hasOwnProperty(c)&&a.DOMNodes[c].value.length&&(a.DOMNodes[c].disabled=!1);a.fullAddress=e.unrestricted_value,a.invalidateAddress=!!(s.value.length&&n.value.length&&i.value.length&&r.value.length)},this.inputObserver=i.c,this.fields=e,this.suggestionsService=t,this.fullAddressEl=document.getElementById("fullAddress"),this.invalidateAddress=!this.fullAddress.length,this.observers=new Map,this.DOMNodes=this.findDOMNodes(e),this.searchInProgress=!1}return Object.defineProperty(FormService.prototype,"postalCode",{get:function(){return this.DOMNodes.zip.value},enumerable:!1,configurable:!0}),Object.defineProperty(FormService.prototype,"fullAddress",{get:function(){return this.fullAddressEl.value},set:function(e){this.fullAddressEl.value=this.fields.fullAddress=e?compact([this.DOMNodes.zip.value,e]).join(", "):""},enumerable:!1,configurable:!0}),FormService.prototype.initSuggestions=function(){for(var e in this.DOMNodes)this.DOMNodes.hasOwnProperty(e)&&(this.DOMNodes[e].disabled=!0,this.DOMNodes[e].dataset.bounds=e,f[e]&&(this.DOMNodes[e].dataset.constraints=f[e]),this.inputObserver.observe(this.DOMNodes[e]),this.DOMNodes[e].addEventListener("change.observe",this.onInput2),this.DOMNodes[e].addEventListener("input",this.onInput),this.DOMNodes[e].addEventListener("blur",this.onBlur),!this.DOMNodes[e].value.length||this.invalidateAddress||this.fullAddress.length||(this.invalidateAddress=!0));this.enableSuggestions(this.DOMNodes.city,n.city),this.DOMNodes.city.disabled=!1,this.validatePlugin=jQuery(this.DOMNodes.city.form).validate(),this.validatePlugin?(this.submitHandler=this.validatePlugin.settings.submitHandler,this.validatePlugin.settings.submitHandler=this.onSubmit):(this.submitHandler=this.DOMNodes.city.form.onsubmit,this.DOMNodes.city.form.onsubmit=this.onSubmit),this.DOMNodes.city.dispatchEvent(new Event("input",{cancelable:!0,bubbles:!0})),this.fetchFullAddressIfNeeded();var t=this.DOMNodes.city.form;t&&!Reflect.hasMetadata(h,t)&&Reflect.defineMetadata(h,this,t)},FormService.prototype.isValid=function(){var e=this.DOMNodes,t=e.city,s=e.street,n=e.house,a=e.zip,i=isVisible(t),r=isVisible(s),o=isVisible(n),c=isVisible(a),d=this.invalidateAddress||this.userChanges||this.externalChanges;return i||r||o||c||(d=!1),!(d||i&&!t.value.length||r&&!s.value.length||o&&!n.value.length||c&&!a.value.length)},FormService.prototype.getSuggestionsService=function(){return this.suggestionsService},FormService.prototype.getQueryString=function(){return this.getQuery()},FormService.prototype.verifyPostalCode=function(e){var t=this;void 0===e&&(e=this.postalCode);var s=this.getQuery();return this.suggestionsService.suggestAddress(s,null,10).then((function(e){return e.length?t.matchAddressByFields(e[0].data)&&t.fullAddress?(t.fullAddress=e[0].unrestricted_value,t.setNewAddress(e[0]),Promise.resolve()):t.showPickupAddressForm(e).then((function(){return null})):Promise.resolve()}))},FormService.prototype.findDOMNodes=function(e){return{apartment:document.getElementById("addressApartmentNumber"),city:document.querySelector(e.city),street:document.querySelector(e.street),house:document.querySelector(e.house),zip:document.querySelector(e.zip)}},FormService.prototype.enableSuggestions=function(e,t,s){void 0===s&&(s=null);var n=jQuery(e),a=n.data("suggestions");if(!a||a.isUnavailable()){if(a&&a.isUnavailable())return a.clear(),void a.enable();var i={autoSelectFirst:!1,bounds:t,constraints:s,hint:!1,params:{query:this.getQuery()},triggerSelectOnEnter:!1,onInvalidateSelection:this.onInvalidateSelection.bind(this,e),onSelect:this.onSelect.bind(this,e),onSelectNothing:this.onSelectNothing.bind(this,e),token:this.suggestionsService.token,type:"ADDRESS"};n.suggestions(i),this.DOMNodes[e.dataset.constraints]&&this.enableSuggestions(this.DOMNodes[e.dataset.constraints],this.DOMNodes[e.dataset.constraints].dataset.bounds,e)}},FormService.prototype.onInvalidateSelection=function(e,t){this.invalidateAddress=!0,this.disableSuggestions(e),this.setFullAddress("")},FormService.prototype.onSelect=function(e,t){this.invalidateAddress=this.userChanges=this.externalChanges=!1,e.dataset.constraints&&this.DOMNodes[e.dataset.constraints]&&this.enableSuggestions(this.DOMNodes[e.dataset.constraints],e.dataset.constraints,e);var s=this.DOMNodes,n=s.city,a=s.street,i=s.house;if(n.value.length&&a.value.length&&i.value.length){this.searchInProgress=!0;var r=t.data.postal_code||"";this.DOMNodes.zip.value=r,this.DOMNodes.zip.defaultValue=r,this.setFullAddress(t.unrestricted_value||t.value||"")}},FormService.prototype.onSelectNothing=function(e,t){this.invalidateAddress=!0,e.value.length&&this.DOMNodes[e.dataset.constraints]&&(this.DOMNodes[e.dataset.constraints].disabled=!1),this.disableSuggestions(e)},FormService.prototype.getQuery=function(){return compact([this.DOMNodes.city.value,this.DOMNodes.street.value,this.DOMNodes.house.value,this.DOMNodes.apartment.value]).join(", ")},FormService.prototype.disableSuggestions=function(e){if(this.DOMNodes[e.dataset.constraints]){var t=jQuery(this.DOMNodes[e.dataset.constraints]).data("suggestions");t&&!t.isUnavailable()&&(t.disable(),this.DOMNodes[e.dataset.constraints]&&this.disableSuggestions(this.DOMNodes[e.dataset.constraints]))}},FormService.prototype.setFullAddress=function(e){this.isValid()||e||(e=this.getQuery()),this.fullAddress=e;var t=document.querySelector(".dadata-full-address-container");t&&t.classList.toggle("hidden",!e.trim())},FormService.prototype.fetchFullAddressIfNeeded=function(){var e=this,t=this.DOMNodes,s=t.city,n=t.street,a=t.house,i=(t.zip,s.value&&n.value&&a.value),r=this.getQuery(),o=document.getElementById("fullAddress");i&&r&&o&&(o.value.trim()||this.suggestionsService.suggestAddress(r,null,1).then((function(t){t.length&&e.matchAddressByFields(t[0].data)?e.setFullAddress(t[0].unrestricted_value||t[0].value||null):e.setFullAddress(e.getQuery())})))},FormService.prototype.showPickupAddressForm=function(e){var t=this;return new Promise((function(s){var n=d.render(c.createElement(o.a,{addresses:e,buttonLabelAccept:Object(i.h)("dadata_btn_accept"),buttonLabelCancel:Object(i.h)("dadata_btn_cancel"),className:"address-box",dismiss:!0,isVisible:!0,title:Object(i.h)("dadata_title_confirm_address"),hint:Object(i.h)("dadata_suggestions_hint")}),document.createElement("div"));n.onConfirm.pipe(Object(l.p)((function(e){t.setNewAddress(e)})),Object(l.d)(300),Object(l.p)((function(){t.validatePlugin.resetForm(),t.validatePlugin.checkForm(),t.validatePlugin.showErrors()})),Object(l.p)((function(){t.validatePlugin.valid()&&s(!0)}))).subscribe(),n.onCancel.pipe(Object(l.p)((function(){t.fullAddress="",s(!1)}))).subscribe()}))},FormService.prototype.getCity=function(e){return e.city_with_type||compact([e.city_type,e.city]).join(" ")||e.city_type_full},FormService.prototype.getSettlement=function(e){return e.settlement_with_type||compact([e.settlement_type,e.settlement]).join(" ")||e.settlement_type_full},FormService.prototype.getStreet=function(e){return e.street_with_type||compact([e.street_type,e.street]).join(" ")||e.street_type_full},FormService.prototype.getHouse=function(e){return compact([e.house_type,e.house,e.block_type,e.block]).join(" ")},FormService.prototype.getFlat=function(e){return compact([e.flat_type,e.flat]).join(" ")},FormService.prototype.matchAddressByFields=function(e){var t=this.getCity(e)||this.getSettlement(e),s=this.getStreet(e),n=this.getHouse(e),a=(e.postal_code||"").trim();return t===this.DOMNodes.city.value.trim()&&s===this.DOMNodes.street.value.trim()&&n===this.DOMNodes.house.value.trim()&&a===this.postalCode.trim()},Object(a.f)([i.i,Object(a.j)("design:type",Boolean)],FormService.prototype,"invalidateAddress",void 0),Object(a.f)([i.i,Object(a.j)("design:type",Boolean)],FormService.prototype,"externalChanges",void 0),Object(a.f)([i.i,Object(a.j)("design:type",Boolean)],FormService.prototype,"userChanges",void 0),Object(a.f)([i.i,Object(a.j)("design:type",String)],FormService.prototype,"prevQuery",void 0),FormService}(),initialize=function(){setTimeout((function(){if(m.config.get("dadata/suggestions/enabled")){var e=Object(i.m)(u.SuggestionsService);new b({city:m.config.get("dadata/suggestions/formFields/city"),fullAddress:m.config.get("dadata/suggestions/formFields/full_address"),house:m.config.get("dadata/suggestions/formFields/house"),street:m.config.get("dadata/suggestions/formFields/street"),zip:m.config.get("dadata/suggestions/formFields/zip")},e).initSuggestions()}}),1500)},getFormServiceFromDOMNode=function(e){return e&&Reflect.hasMetadata(h,e)?Reflect.getMetadata(h,e):null}},"./packages/apps/legacy-dadata/src/suggestions/index.ts":function(e,t,s){"use strict";s.r(t),s.d(t,"AddressBounds",(function(){return n})),s.d(t,"SuggestionsService",(function(){return c}));var n,a=s("./common/temp/node_modules/.pnpm/tslib@2.3.1/node_modules/tslib/tslib.es6.js"),i=s("./packages/apps/legacy-dadata/src/api/responseCodes.ts"),r=s("./packages/libs/logger/lib/index.js"),o=s("./packages/libs/di/lib/index.js");!function(e){e.City="city",e.Street="street",e.House="house"}(n||(n={}));var c=function(){function SuggestionsService(){this.cache=new Map,this.serviceInfo=null;var e=Object(o.g)(o.a);this._url=e.config.get("dadata/settings/url"),this._token=e.config.get("dadata/settings/token"),this.statusUrl=e.config.get("dadata/settings/status_url")}return Object.defineProperty(SuggestionsService.prototype,"token",{get:function(){return this._token},set:function(e){this._token=e},enumerable:!1,configurable:!0}),Object.defineProperty(SuggestionsService.prototype,"url",{get:function(){return this._url},set:function(e){this._url=e},enumerable:!1,configurable:!0}),SuggestionsService.prototype.loadFromLocalStorage=function(){var e,t;this.cache.clear();var s=window.localStorage.getItem("dadata_suggestions");if(s){var n=JSON.parse(s);try{for(var i=Object(a.n)(n),r=i.next();!r.done;r=i.next()){var o=Object(a.k)(r.value,2),c=o[0],d=o[1];this.cache.set(c,d)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}}},SuggestionsService.prototype.saveToLocalStorage=function(){this.cache.size&&window.localStorage.setItem("dadata_suggestions",JSON.stringify(Object(a.m)([],Object(a.k)(this.cache))))},SuggestionsService.prototype.clearCache=function(){window.localStorage.removeItem("dadata_suggestions"),this.cache.clear()},SuggestionsService.prototype.suggestAddress=function(e,t,s){void 0===s&&(s=5);var n=Object.create(null);return n.count=s,n.query=e,t&&(n.from_bound=n.to_bound={value:t}),n.restrict_value=!0,this.fetchIfNeeded(n)},SuggestionsService.prototype.getServiceInfo=function(e){var t=this;return void 0===e&&(e=!1),Object(o.g)(o.a).config.get("dadata/suggestions/enabled")?this.serviceInfo&&!e?Promise.resolve(this.serviceInfo):fetch(this.statusUrl+"/address").then((function(e){return e.json()})).then((function(e){return t.serviceInfo=e})):Promise.resolve({search:!1,enrich:!1,state:"DISABLED",name:"address"})},SuggestionsService.prototype.fetchIfNeeded=function(e){var t=this,s="["+(e.from_bound?e.from_bound.value:"*")+"]["+e.query+"]";return this.cache.has(s)?Promise.resolve(this.cache.get(s)):this.getServiceInfo().then((function(n){if("ENABLED"===n.state&&n.search){var a=new Headers;a.append("Content-Type","application/json"),t.token&&a.append("Authorization","Token "+t.token);var o={body:JSON.stringify(e),headers:a,method:"POST"};return fetch(t.url,o).then((function(e){var t,s=Math.min(500,e.status);if(i.a.has(s))throw t=i.a.get(s),new Error("[DaData API Error "+s+"] "+t);return e})).then((function(e){return e.json()})).then((function(e){return e.suggestions})).then((function(e){return t.cache.set(s,e),t.saveToLocalStorage(),e})).catch((function(e){return Object(r.b)(e.message),[]}))}return[]}))},SuggestionsService}()},"./packages/libs/legacy-core/lib/EventEmitter.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n,a=s("./common/temp/node_modules/.pnpm/rxjs@6.4.0/node_modules/rxjs/_esm5/index.js"),i=(n=function extendStatics(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function __(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}),r=function(e){function EventEmitter(){var t=null!==e&&e.apply(this,arguments)||this;return t.emit=function(s){return e.prototype.next.call(t,s)},t}return i(EventEmitter,e),EventEmitter.prototype.subscribe=function(t,s,n){var i=e.prototype.subscribe.call(this,t,s,n);return t instanceof a.f&&t.add(i),i},EventEmitter}(a.e)},"./packages/libs/legacy-core/lib/index.js":function(e,t,s){"use strict";var n=s("./packages/libs/legacy-core/lib/EventEmitter.js");s.d(t,"a",(function(){return n.a}))},2:function(e,t){},react:function(e,t){e.exports=React},"react-dom":function(e,t){e.exports=ReactDOM}},[["./packages/apps/bridge/src/index.ts",1,0,2]]]);